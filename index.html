<!DOCTYPE html>
<html>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Graduación 2024 - Luis Pedro Gómez de la Roca</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <body style="margin : 0px; overflow: hidden;">
        <a-scene embedded arjs>
            <a-marker type="pattern" url="markers/pattern-birrete.patt">
                <!-- Placeholder planes for each image, their properties will be set dynamically -->
                <a-plane id="image-1" position="0 0 0.5" rotation="-90 0 0" visible="false"
                         material="opacity: 0; transparent: true"></a-plane>
                <a-plane id="image-2" position="0 0 0.5" rotation="-90 0 0" visible="false"
                         material="opacity: 0; transparent: true"></a-plane>
                <a-plane id="image-3" position="0 0 0.5" rotation="-90 0 0" visible="false"
                         material="opacity: 0; transparent: true"></a-plane>
                <a-plane id="image-4" position="0 0 0.5" rotation="-90 0 0" visible="false"
                         material="opacity: 0; transparent: true"></a-plane>
                <a-plane id="image-5" position="0 0 0.5" rotation="-90 0 0" visible="false"
                         material="opacity: 0; transparent: true"></a-plane>
                <a-plane id="image-6" position="0 0 0.5" rotation="-90 0 0" visible="false"
                         material="opacity: 0; transparent: true"></a-plane>
                <a-plane id="image-7" position="0 0 0.5" rotation="-90 0 0" visible="false"
                         material="opacity: 0; transparent: true"></a-plane>
                <a-plane id="image-8" position="0 0 0.5" rotation="-90 0 0" visible="false"
                         material="opacity: 0; transparent: true"></a-plane>
                <a-plane id="image-9" position="0 0 0.5" rotation="-90 0 0" visible="false"
                         material="opacity: 0; transparent: true"></a-plane>
            </a-marker>

            <a-assets>
                <a-asset-item id="graciaspp" src="3d/graciaspp.glb"></a-asset-item>
            </a-assets>


            <a-marker type="pattern" url="markers/pattern-icono1.patt">
                <!-- Placeholder planes for each image, their properties will be set dynamically -->
                <a-entity gltf-model="#graciaspp"></a-entity>
            </a-marker>
            <a-marker type="pattern" url="markers/pattern-icono2.patt">
                <!-- Placeholder planes for each image, their properties will be set dynamically -->
                <a-entity gltf-model="#graciaspp"></a-entity>
            </a-marker>
            <a-marker type="pattern" url="markers/pattern-icono3.patt">
                <!-- Placeholder planes for each image, their properties will be set dynamically -->
                <a-entity gltf-model="#graciaspp"></a-entity>
            </a-marker>
            <a-marker type="pattern" url="markers/pattern-icono4.patt">
                <!-- Placeholder planes for each image, their properties will be set dynamically -->
                <a-entity gltf-model="#graciaspp"></a-entity>
            </a-marker>
            <a-marker type="pattern" url="markers/pattern-icono5.patt">
                <!-- Placeholder planes for each image, their properties will be set dynamically -->
                <a-entity gltf-model="#graciaspp"></a-entity>
            </a-marker>
            <a-marker type="pattern" url="markers/pattern-icono6.patt">
                <!-- Placeholder planes for each image, their properties will be set dynamically -->
                <a-entity gltf-model="#graciaspp"></a-entity>
            </a-marker>
            <a-marker type="pattern" url="markers/pattern-icono7.patt">
                <!-- Placeholder planes for each image, their properties will be set dynamically -->
                <a-entity gltf-model="#graciaspp"></a-entity>
            </a-marker>
            <a-marker type="pattern" url="markers/pattern-icono8.patt">
                <!-- Placeholder planes for each image, their properties will be set dynamically -->
                <a-entity gltf-model="#graciaspp"></a-entity>
            </a-marker>
            <a-entity camera></a-entity>
        </a-scene>

        <script>
            const scalingFactor = 3;
            const markerReferenceSize = 1;

            const imagePaths = [
                'img/1.JPG',
                'img/2.JPG',
                'img/3.JPG',
                'img/4.JPG',
                'img/5.JPG',
                'img/6.JPG',
                'img/7.JPG',
                'img/8.JPG',
                'img/9.JPG'
            ];

            function setPlaneDimensions(imagePath, planeId, scalingFactor, markerSize) {
                const img = new Image();
                img.onload = function () {
                    const originalWidth = img.naturalWidth;
                    const originalHeight = img.naturalHeight;
                    const imageAspectRatio = originalWidth / originalHeight;
                    const newHeight = markerSize * scalingFactor;
                    const newWidth = newHeight * imageAspectRatio;

                    const plane = document.querySelector(`#${planeId}`);
                    plane.setAttribute('width', newWidth);
                    plane.setAttribute('height', newHeight);
                    plane.setAttribute('src', imagePath);
                };

                img.onerror = function () {
                    console.error(`Failed to load image: ${imagePath}`);
                };

                img.src = imagePath;
            }

            imagePaths.forEach((path, index) => {
                const planeId = `image-${index + 1}`;
                setPlaneDimensions(path, planeId, scalingFactor, markerReferenceSize);
            });

            function showImagesWithTransition(imageIds, currentIndex = 0) {
                const prevIndex = (currentIndex - 1 + imageIds.length) % imageIds.length;
                const nextIndex = (currentIndex + 1) % imageIds.length;
                
                const prevImage = document.querySelector(`#${imageIds[prevIndex]}`);
                const currentImage = document.querySelector(`#${imageIds[currentIndex]}`);

                prevImage.removeAttribute('animation__fadein');
                prevImage.removeAttribute('animation__fadeout');
                prevImage.setAttribute('material', 'opacity', '0');
                prevImage.setAttribute('visible', 'false');

                currentImage.setAttribute('visible', 'true');
                currentImage.setAttribute('animation__fadein', {
                    property: 'material.opacity',
                    to: 1,
                    dur: 1000,
                    easing: 'easeInOutQuad'
                });

                setTimeout(() => {
                    currentImage.setAttribute('animation__fadeout', {
                        property: 'material.opacity',
                        to: 0,
                        dur: 1000,
                        easing: 'easeInOutQuad'
                    });

                    currentImage.addEventListener('animationcomplete__fadeout', () => {
                        currentImage.setAttribute('visible', 'false');
                    });

                    setTimeout(() => {
                        //nextIndex = (currentIndex + 1) % imageIds.length;
                        showImagesWithTransition(imageIds, nextIndex);
                    }, 1000);
                }, 3000);
            }

            const imageIds = imagePaths.map((_, index) => `image-${index + 1}`);
            setTimeout(() => showImagesWithTransition(imageIds), 1000);
        </script>
    </body>
</html>
